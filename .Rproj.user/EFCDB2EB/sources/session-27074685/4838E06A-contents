#Project Question:
#How do air quality trends vary across different regions and sub-regions, 
#and what are the potential factors driving these variations?



#library
library(dplyr)
library(ggplot2)
library(tidyr)
library(lubridate)
library(forecast)

#load dataset
aqi_df <- read_csv("data_date.csv")
country_df <- read_csv("continents2.csv")

#inspect the data sets
head(aqi_df)
head(country_df)

# Select relevant columns from the country_df
country_df <- country_df %>% 
  select(name, sub_region)

# Merge the datasets on the country and name columns
merged_df <- aqi_df %>%
  inner_join(country_df, by = c("Country" = "name"))

# Select only the columns of interest
final_df <- merged_df %>% 
  select(Date, Country, Status, `AQI Value`, `alpha-2`, region, `sub-region`)

#convert the data column to date type
final_df$Date <- as.Date(final_df$Date, formate = "%Y-%m-%d")

#EDA
summary(final_df)
ggplot(final_df, aes(x = `AQI Value`)) +
  geom_histogram(binwidth = 10) +
  facet_wrap(~region)

# Trend Analysis
ggplot(final_df, aes(x = Date, y = `AQI Value`, color = `sub-region`)) +
  geom_line() +
  facet_wrap(~region) +
  labs(title = "Trend Analysis of AQI Values by Region and Sub-region",
       x = "Date",
       y = "AQI Value",
       color = "Sub-region")


# Comparative Analysis
aqi_region_summary <- final_df %>%
  group_by(region) %>%
  summarise(mean_aqi = mean(`AQI Value`, na.rm = TRUE), 
            median_aqi = median(`AQI Value`, na.rm = TRUE),
            sd_aqi = sd(`AQI Value`, na.rm = TRUE))

print(aqi_region_summary)


# Decompose the time series for a specific region
region_ts <- final_df %>%
  filter(region == "Asia") %>%
  group_by(Date) %>%
  summarise(mean_aqi = mean(`AQI Value`, na.rm = TRUE))

region_ts$Date <- as.Date(region_ts$Date)
region_ts <- ts(region_ts$mean_aqi, start = c(year(min(region_ts$Date)), month(min(region_ts$Date))), frequency = 12)

decomposed_ts <- stl(region_ts, s.window = "periodic")
plot(decomposed_ts)
